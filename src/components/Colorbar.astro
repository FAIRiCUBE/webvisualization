<div id="colorbar"></div>

<script>
import { getPaletteAsGradient } from '../scripts/palette';
import * as d3 from 'd3';
// Listen for the changes to palette or source
document.addEventListener('newpalette', updateColorbar);
document.addEventListener('newsource', updateColorbar);


function updateColorbar() {

  const colorbar = document.getElementById('colorbar');
  if (!colorbar) return;

  colorbar.innerHTML = '';

  const palette = localStorage.getItem('palette');
  colorbar.style.display = (palette=='rgb') ? 'none' : 'flex';

  if (palette=='qgis') {
    const values = JSON.parse(localStorage.getItem('QGISColorfileValues') || '[]');
    for (const value of values){
      const div = document.createElement('div');
      div.innerHTML = value.toFixed(2);
      colorbar.appendChild(div);
    }
    colorbar.style.background = getPaletteAsGradient();
    return;
  }

  const min : number = parseFloat(localStorage.getItem('min') ?? '0');
  const max : number = parseFloat(localStorage.getItem('max') ?? '1');
  const nmiddletics = (min==0 && max==1) ? 0 : 3;
  // Get Ntics evenly spaced between min and max
  const middltics = d3.range(min, max, (max-min)/(nmiddletics-1));
  const labels = [...middltics.map(t => t.toFixed(3)), max.toFixed(3)];
  for (let i = 0; i < labels.length; i++){
      let div = document.createElement('div');
      div.innerHTML = labels[i]; // Value
      colorbar.appendChild(div);
  }

  colorbar.style.background = getPaletteAsGradient();

}





</script>
<style>

#colorbar {
  position: absolute;
  bottom: 50px;
  right: 50px;
  width: 400px;
  height: 5px;
  background: red;
  border-radius: 5px;
  background-color: red;
  backdrop-filter: blur(5px);
  padding: 10px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  color: darkslategray;
  background-color: var(--nilu-dark-gray);
  font-size: 0.8em;
  border-radius: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  div {
    mix-blend-mode: difference;
    font-size: 1em;
    color: whit;
  }
}
</style>